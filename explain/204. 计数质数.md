---
title: 204. 计数质数
created: 2025-01-05
tags:
  - 难度/中等
---
[204. 计数质数](https://leetcode.cn/problems/count-primes/)

给定整数 `n` ，返回 _所有小于非负整数 `n` 的质数的数量_ 。

**示例 1：**

**输入：**n = 10
**输出：**4
**解释：**小于 10 的质数一共有 4 个, 它们是 2, 3, 5, 7 。

**示例 2：**

**输入：**n = 0
**输出：**0

**示例 3：**

**输入：**n = 1
**输出**：0

**提示：**

- `0 <= n <= 5 * 10^6`

接下来介绍的方法叫做「素数筛选法」，这个方法是古希腊一位名叫埃拉托色尼的大佬发明的，我们在中学的教课书上见过他的大名，因为他就是第一个通过物体的影子正确计算地球周长的人，被推崇为「地理学之父」。

回到正题，素数筛选法的核心思路是和上面的常规思路反着来：

首先从 2 开始，我们知道 2 是一个素数，那么 2 × 2 = 4, 3 × 2 = 6, 4 × 2 = 8... 都不可能是素数了。

然后我们发现 3 也是素数，那么 3 × 2 = 6, 3 × 3 = 9, 3 × 4 = 12... 也都不可能是素数了。

Wikipedia 的这个 GIF 很形象：

![](https://labuladong.online/algo/images/prime/1.gif)

看到这里，你是否有点明白这个排除法的逻辑了呢？先看我们的第一版代码：

```python
class Solution:
    def countPrimes(self, n: int) -> int:
        isPrime = [True] * n
        for i in range(2, n):
            if isPrime[i]:
                for j in range(2 * i, n, i):
                    isPrime[j] = False

        count = 0
        for i in range(2, n):
            if isPrime[i]: 
                count += 1

        return count
```

如果上面这段代码你能够理解，那么你已经掌握了整体思路，但是还有两个细微的地方可以优化。

首先，回想本文开头介绍的 `isPrime` 素数判定函数，由于因子的对称性，其中的 for 循环只需要遍历 `[2,sqrt(n)]` 就够了。这里也是类似的，我们外层的 for 循环也只需要遍历到 `sqrt(n)`

内层循环的优化：比如 `n = 25`，`i = 5` 时算法会标记 5 × 2 = 10，5 × 3 = 15 等等数字，但是这两个数字已经被 `i = 2` 和 `i = 3` 的 2 × 5 和 3 × 5 标记了。

我们可以稍微优化一下，让 `j` 从 `i * i` 开始遍历，而不是从 `2 * i` 开始

这样，素数计数的算法就高效实现了，其实这个算法有一个名字，叫做 Sieve of Eratosthenes。看下完整的最终代码：

```python
class Solution:
    def countPrimes(self, n: int) -> int:
        isPrime = [True] * n
        for i in range(2, int(n ** 0.5) + 1):
            if isPrime[i]:
                for j in range(i * i, n, i):
                    isPrime[j] = False

        count = 0
        for i in range(2, n):
            if isPrime[i]: 
                count += 1

        return count
```

**该算法的时间复杂度比较难算**，显然时间跟这两个嵌套的 for 循环有关，其操作数应该是：

n/2 + n/3 + n/5 + n/7 + ...  
= n × (1/2 + 1/3 + 1/5 + 1/7...)

括号中是素数的倒数。其最终结果是 O(N∗loglogN)

https://labuladong.online/algo/frequency-interview/print-prime-number/#%E9%AB%98%E6%95%88%E5%AE%9E%E7%8E%B0-countprimes

